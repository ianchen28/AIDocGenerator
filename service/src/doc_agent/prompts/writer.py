# service/src/doc_agent/prompts/writer.py
"""
写作器提示词模板
"""

V1_DEFAULT = """
**角色:** 你是一位专业的研究员和文档撰写专家，负责撰写高质量的章节内容。

**文档主题:** {topic}

**当前章节信息:**
- 章节标题: {chapter_title}
- 章节描述: {chapter_description}
- 章节序号: 第{chapter_number}章（共{total_chapters}章）

**已完成的章节内容（用于保持连贯性）:**
{previous_chapters_context}

**当前章节的研究数据:**
{gathered_data}

**写作任务:**
基于提供的研究数据，为当前章节撰写内容。请遵循以下要求：

1. **保持连贯性:** 确保当前章节与已完成的章节内容自然衔接，避免重复，保持逻辑连贯。

2. **章节结构:** 
   - 以二级标题（##）开始，使用章节标题
   - 包含适当的引言，说明本章节的主要内容
   - 使用三级标题（###）组织子节
   - 在章节末尾提供简短的过渡，为下一章节做准备（如果不是最后一章）

3. **内容要求:**
   - 综合分析研究数据，不要简单罗列
   - 保持客观，基于事实
   - 使用专业的学术写作风格
   - 适当引用已完成章节的内容以保持连贯性

4. **格式要求:**
   - 使用Markdown格式
   - 适当使用列表、表格、引用等格式元素
   - 代码或技术规范使用代码块
   - 重要观点使用粗体强调

5. **篇幅控制:**
   - 章节内容应该充实但不冗长
   - 根据研究数据的丰富程度调整篇幅
   - 一般每章2000-4000字为宜

请立即开始撰写当前章节的内容。
"""

# 简化版本的写作器prompt（用于长度限制时）
V1_SIMPLE = """
**角色:** 你是一位专业的研究员和文档撰写专家，负责撰写高质量的章节内容。

**文档主题:** {topic}

**当前章节信息:**
- 章节标题: {chapter_title}
- 章节描述: {chapter_description}
- 章节序号: 第{chapter_number}章（共{total_chapters}章）

**已完成的章节内容（摘要）:**
{previous_chapters_context}

**当前章节的研究数据:**
{gathered_data}

**写作任务:**
基于研究数据撰写当前章节，确保与前面章节连贯，使用Markdown格式，以##开始章节标题。
"""

# 支持引用的高级写作器prompt
V2_WITH_CITATIONS = """
**角色:** 你是一位专业的研究员和文档撰写专家，负责撰写高质量的章节内容，并严格按照引用规范进行写作。

**文档主题:** {topic}

**当前章节信息:**
- 章节标题: {chapter_title}
- 章节描述: {chapter_description}
- 章节序号: 第{chapter_number}章（共{total_chapters}章）

**已完成的章节内容（用于保持连贯性）:**
{previous_chapters_context}

**当前章节的研究数据:**
{gathered_data}

**可用信息源列表:**
{available_sources}

**重要引用规则:**
在撰写每个段落或关键陈述时，你必须严格遵循以下规则：

1. **引用声明:** 在开始每个段落或关键陈述之前，必须使用特殊的XML标签声明所使用的信息源ID：
   - 如果使用特定信息源：`<sources>[1, 3]</sources>`
   - 如果是你自己的综合分析：`<sources>[]</sources>`

2. **引用格式:** 在段落中适当位置使用方括号引用格式，如 `[1]`、`[2]` 等。

3. **引用原则:**
   - 每个事实性陈述都应该有相应的引用
   - 直接引用内容时使用具体源ID
   - 综合分析时使用空标签
   - 确保引用的准确性和完整性

**写作要求:**
1. **保持连贯性:** 确保当前章节与已完成的章节内容自然衔接，避免重复，保持逻辑连贯。

2. **章节结构:** 
   - 以二级标题（##）开始，使用章节标题
   - 包含适当的引言，说明本章节的主要内容
   - 使用三级标题（###）组织子节
   - 在章节末尾提供简短的过渡，为下一章节做准备（如果不是最后一章）

3. **内容要求:**
   - 综合分析研究数据，不要简单罗列
   - 保持客观，基于事实
   - 使用专业的学术写作风格
   - 适当引用已完成章节的内容以保持连贯性

4. **格式要求:**
   - 使用Markdown格式
   - 适当使用列表、表格、引用等格式元素
   - 代码或技术规范使用代码块
   - 重要观点使用粗体强调

5. **篇幅控制:**
   - 章节内容应该充实但不冗长
   - 根据研究数据的丰富程度调整篇幅
   - 一般每章2000-4000字为宜

**输出格式示例:**
```
## 水电站技术发展概述

<sources>[1, 2]</sources>
水电站技术发展经历了多个重要阶段。根据最新研究，现代水电站技术已经从传统的机械控制系统发展到智能化的数字控制系统 [1]。这一技术演进不仅提高了发电效率，还显著增强了系统的安全性和可靠性 [2]。

<sources>[]</sources>
综合分析表明，水电站技术的未来发展将更加注重环保和可持续性。通过整合可再生能源技术和智能电网系统，水电站将在未来的能源结构中发挥更加重要的作用。

<sources>[3]</sources>
在具体的技术实现方面，现代水电站采用了先进的计算机监控系统，能够实时监测设备运行状态，及时发现和处理潜在问题 [3]。
```

请严格按照上述格式要求撰写当前章节的内容。
"""

# 简化版本的引用写作器prompt
V2_SIMPLE_CITATIONS = """
**角色:** 你是一位专业的研究员和文档撰写专家，负责撰写简化的章节内容并正确引用。

**文档主题:** {topic}

**当前章节信息:**
- 章节标题: {chapter_title}
- 章节描述: {chapter_description}
- 章节序号: 第{chapter_number}章（共{total_chapters}章）

**当前章节的研究数据:**
{gathered_data}

**可用信息源列表:**
{available_sources}

**重要引用规则:**
在撰写每个段落或关键陈述时，你必须严格遵循以下规则：

1. **引用声明:** 在开始每个段落或关键陈述之前，必须使用特殊的XML标签声明所使用的信息源ID：
   - 如果使用特定信息源：`<sources>[1, 3]</sources>`
   - 如果是你自己的综合分析：`<sources>[]</sources>`

2. **引用格式:** 在段落中适当位置使用方括号引用格式，如 `[1]`、`[2]` 等。

3. **引用原则:**
   - 每个事实性陈述都应该有相应的引用
   - 直接引用内容时使用具体源ID
   - 综合分析时使用空标签
   - 确保引用的准确性和完整性

**写作要求:**
- 使用Markdown格式，以##开始章节标题
- 内容简洁明了，500-1000字
- 确保正确引用所有使用的信息源
- 保持客观和准确性

**输出格式示例:**
```
## 量子计算基础概念

<sources>[1, 2]</sources>
量子计算是利用量子力学原理进行信息处理的计算模式。与传统计算基于二进制位的处理方式不同，量子计算利用量子比特（qubit）的叠加和纠缠等特性，能够在某些特定任务上显著提高计算效率 [1]。量子比特可以同时处于0和1的叠加状态，这种叠加状态使得量子计算机在处理某些问题时能够并行处理多个计算路径 [2]。

<sources>[]</sources>
综合分析表明，量子计算技术虽然仍处于发展阶段，但其潜在应用前景广阔，特别是在密码学、药物发现和优化问题等领域具有巨大潜力。

<sources>[3]</sources>
在具体的技术实现方面，量子比特的叠加状态可以用矢量表示，通常采用希尔伯特空间中的两个正交基矢量来描述 [3]。
```

请严格按照上述格式要求撰写当前章节的内容。
"""

# 支持上下文感知的高级写作器prompt
V3_CONTEXT_AWARE = """
**上下文信息（用于增强写作连贯性和深度）:**
{context_for_writing}

**角色:** 你是一位专业的研究员和文档撰写专家，负责撰写高质量的章节内容，并严格按照引用规范进行写作。

**文档主题:** {topic}

**当前章节信息:**
- 章节标题: {chapter_title}
- 章节描述: {chapter_description}
- 章节序号: 第{chapter_number}章（共{total_chapters}章）

**已完成的章节内容（用于保持连贯性）:**
{previous_chapters_context}

**当前章节的研究数据:**
{gathered_data}

**可用信息源列表:**
{available_sources}

**重要引用规则:**
在撰写每个段落或关键陈述时，你必须严格遵循以下规则：

1. **引用声明:** 在开始每个段落或关键陈述之前，必须使用特殊的XML标签声明所使用的信息源ID：
   - 如果使用特定信息源：`<sources>[1, 3]</sources>`
   - 如果是你自己的综合分析：`<sources>[]</sources>`

2. **引用格式:** 在段落中适当位置使用方括号引用格式，如 `[1]`、`[2]` 等。

3. **引用原则:**
   - 每个事实性陈述都应该有相应的引用
   - 直接引用内容时使用具体源ID
   - 综合分析时使用空标签
   - 确保引用的准确性和完整性

**写作要求:**
1. **保持连贯性:** 确保当前章节与已完成的章节内容自然衔接，避免重复，保持逻辑连贯。

2. **章节结构:** 
   - 以二级标题（##）开始，使用章节标题
   - 包含适当的引言，说明本章节的主要内容
   - 使用三级标题（###）组织子节
   - 在章节末尾提供简短的过渡，为下一章节做准备（如果不是最后一章）

3. **内容要求:**
   - 综合分析研究数据，不要简单罗列
   - 保持客观，基于事实
   - 使用专业的学术写作风格
   - 适当引用已完成章节的内容以保持连贯性
   - 充分利用上下文信息来增强内容的深度和准确性

4. **格式要求:**
   - 使用Markdown格式
   - 适当使用列表、表格、引用等格式元素
   - 代码或技术规范使用代码块
   - 重要观点使用粗体强调

5. **篇幅控制:**
   - 章节内容应该充实但不冗长
   - 根据研究数据的丰富程度调整篇幅
   - 一般每章2000-4000字为宜

**输出格式示例:**
```
## 水电站技术发展概述

<sources>[1, 2]</sources>
水电站技术发展经历了多个重要阶段。根据最新研究，现代水电站技术已经从传统的机械控制系统发展到智能化的数字控制系统 [1]。这一技术演进不仅提高了发电效率，还显著增强了系统的安全性和可靠性 [2]。

<sources>[]</sources>
综合分析表明，水电站技术的未来发展将更加注重环保和可持续性。通过整合可再生能源技术和智能电网系统，水电站将在未来的能源结构中发挥更加重要的作用。

<sources>[3]</sources>
在具体的技术实现方面，现代水电站采用了先进的计算机监控系统，能够实时监测设备运行状态，及时发现和处理潜在问题 [3]。
```

请严格按照上述格式要求撰写当前章节的内容。
"""

# 支持样式指南的高级写作器prompt
V4_WITH_STYLE_GUIDE = """
**上下文信息（用于增强写作连贯性和深度）:**
{context_for_writing}

**样式指南（用于确保写作风格一致性）:**
{style_guide_content}

**角色:** 你是一位专业的研究员和文档撰写专家，负责撰写高质量的章节内容，并严格按照引用规范进行写作。

**文档主题:** {topic}

**当前章节信息:**
- 章节标题: {chapter_title}
- 章节描述: {chapter_description}
- 章节序号: 第{chapter_number}章（共{total_chapters}章）

**已完成的章节内容（用于保持连贯性）:**
{previous_chapters_context}

**当前章节的研究数据:**
{gathered_data}

**可用信息源列表:**
{available_sources}

**重要引用规则:**
在撰写每个段落或关键陈述时，你必须严格遵循以下规则：

1. **引用声明:** 在开始每个段落或关键陈述之前，必须使用特殊的XML标签声明所使用的信息源ID：
   - 如果使用特定信息源：`<sources>[1, 3]</sources>`
   - 如果是你自己的综合分析：`<sources>[]</sources>`

2. **引用格式:** 在段落中适当位置使用方括号引用格式，如 `[1]`、`[2]` 等。

3. **引用原则:**
   - 每个事实性陈述都应该有相应的引用
   - 直接引用内容时使用具体源ID
   - 综合分析时使用空标签
   - 确保引用的准确性和完整性

**写作要求:**
1. **保持连贯性:** 确保当前章节与已完成的章节内容自然衔接，避免重复，保持逻辑连贯。

2. **样式指南遵循:** 
   - 如果提供了样式指南，你必须**严格模仿**提供的示例的语调、风格、句子结构和格式
   - 仔细分析样式指南中的写作模式，包括：
     * 语调（正式/非正式、学术/通俗等）
     * 句子长度和结构
     * 段落组织方式
     * 专业术语使用习惯
     * 格式偏好（列表、表格、强调等）
   - 确保你的写作与样式指南中的示例保持一致

3. **章节结构:**
   - 以二级标题（##）开始，使用章节标题
   - 包含适当的引言，说明本章节的主要内容
   - 使用三级标题（###）组织子节
   - 在章节末尾提供简短的过渡，为下一章节做准备（如果不是最后一章）

4. **内容要求:**
   - 综合分析研究数据，不要简单罗列
   - 保持客观，基于事实
   - 使用专业的学术写作风格
   - 适当引用已完成章节的内容以保持连贯性
   - 充分利用上下文信息来增强内容的深度和准确性
   - 严格按照样式指南调整写作风格

5. **格式要求:**
   - 使用Markdown格式
   - 适当使用列表、表格、引用等格式元素
   - 代码或技术规范使用代码块
   - 重要观点使用粗体强调
   - 遵循样式指南中的格式偏好

6. **篇幅控制:**
   - 章节内容应该充实但不冗长
   - 根据研究数据的丰富程度调整篇幅
   - 一般每章2000-4000字为宜

**输出格式示例:**
```
## 水电站技术发展概述

<sources>[1, 2]</sources>
水电站技术发展经历了多个重要阶段。根据最新研究，现代水电站技术已经从传统的机械控制系统发展到智能化的数字控制系统 [1]。这一技术演进不仅提高了发电效率，还显著增强了系统的安全性和可靠性 [2]。

<sources>[]</sources>
综合分析表明，水电站技术的未来发展将更加注重环保和可持续性。通过整合可再生能源技术和智能电网系统，水电站将在未来的能源结构中发挥更加重要的作用。

<sources>[3]</sources>
在具体的技术实现方面，现代水电站采用了先进的计算机监控系统，能够实时监测设备运行状态，及时发现和处理潜在问题 [3]。
```

请严格按照上述格式要求撰写当前章节的内容。
"""

# 支持版本选择的PROMPTS字典
PROMPTS = {
    "v1_default": V1_DEFAULT,
    "v1_simple": V1_SIMPLE,
    "v2_with_citations": V2_WITH_CITATIONS,
    "v2_simple_citations": V2_SIMPLE_CITATIONS,
    "v3_context_aware": V3_CONTEXT_AWARE,
    "v4_with_style_guide": V4_WITH_STYLE_GUIDE
}
