# AIDocGenerator API - Full End-to-End Test
#
# ä½¿ç”¨æ–¹æ³•:
# 1. å°†å…‰æ ‡æ”¾åœ¨æ¯ä¸ªè¯·æ±‚å—ä¸­ (ä»¥ "###" åˆ†éš”)ã€‚
# 2. ç‚¹å‡»å‡ºç°åœ¨è¯·æ±‚ä¸Šæ–¹çš„ "Send Request" æŒ‰é’®ã€‚
# 3. åœ¨å³ä¾§å¼¹å‡ºçš„çª—å£ä¸­æŸ¥çœ‹å“åº”ã€‚
# 4. è¿™ä¸ªæ–‡ä»¶ä¼šè‡ªåŠ¨ä¿å­˜ä¸Šä¸€ä¸ªè¯·æ±‚çš„ç»“æœï¼Œå¹¶ç”¨äºä¸‹ä¸€ä¸ªè¯·æ±‚ (ä¾‹å¦‚ @job_id)ã€‚

# =================================================================
# ç¯å¢ƒå˜é‡ (å¯é€‰ï¼Œä½†æ¨è)
# =================================================================
@baseUrl = http://127.0.0.1:8000/api/v1
@apiKey = my-secret-dev-key-a1b2c3d4
# ğŸ‘† è¯·å°† your_secret_key æ›¿æ¢æˆä½ çš„çœŸå® API Key

###
# =================================================================
# é˜¶æ®µä¸€ï¼šä½œä¸šåˆ›å»ºä¸å¤§çº²ç”Ÿæˆ
# =================================================================

### 1. åˆ›å»ºä¸€ä¸ªæ–°çš„ç”Ÿæˆä½œä¸š
# @name createJob
POST {{baseUrl}}/jobs
Content-Type: application/json
X-API-KEY: {{apiKey}}

{
  "context_id": null,
  "task_prompt": "åˆ†æâ€œåˆ†æ²»ç­–ç•¥â€åœ¨è§£å†³å¤§å‹è¯­è¨€æ¨¡å‹ä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶é—®é¢˜ä¸­çš„åº”ç”¨ã€æŒ‘æˆ˜ä¸æœªæ¥æ–¹å‘"
}

###
# å˜é‡æå–: ä¸‹é¢è¿™è¡Œä¼šè‡ªåŠ¨ä»ä¸Šé¢çš„å“åº”ä¸­æå– job_id
@job_id = {{createJob.response.body.job_id}}

###
# -----------------------------------------------------------------
### 2. è§¦å‘å¤§çº²ç”Ÿæˆ
POST {{baseUrl}}/jobs/{{job_id}}/outline
X-API-KEY: {{apiKey}}

###
# !!! è¯·æ‰‹åŠ¨ç­‰å¾…å‡ ç§’é’Ÿï¼Œè®© Celery Worker å¼€å§‹å¤„ç†ä»»åŠ¡ !!!
# -----------------------------------------------------------------

### 3. è·å–å¤§çº² (è½®è¯¢ç›´åˆ° status ä¸º READY)
# @name getOutline
GET {{baseUrl}}/jobs/{{job_id}}/outline
X-API-KEY: {{apiKey}}

###
# !!! å¦‚æœä¸Šä¸€æ­¥çš„ outline_status è¿˜æ˜¯ GENERATINGï¼Œè¯·å†æ¬¡ç‚¹å‡»ä¸Šé¢çš„ "Send Request" !!!
# å½“ status å˜ä¸º READY åï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶å³ä¾§å“åº”ä¸­çš„æ•´ä¸ª outline JSON å¯¹è±¡ã€‚
# -----------------------------------------------------------------

### 4. æäº¤å¤§çº²å¹¶å¼€å§‹æœ€ç»ˆç”Ÿæˆ
# @name startFinalGeneration
PUT {{baseUrl}}/jobs/{{job_id}}/outline
Content-Type: application/json
X-API-KEY: {{apiKey}}

# vvvvvvvvvvvv åœ¨è¿™é‡Œç²˜è´´ä½ ä¸Šä¸€æ­¥è·å–åˆ°çš„å¤§çº²å†…å®¹ vvvvvvvvvvvv
{
    "outline": {
    "title": "å…³äº'åˆ†æâ€œåˆ†æ²»ç­–ç•¥â€åœ¨è§£å†³å¤§å‹è¯­è¨€æ¨¡å‹ä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶é—®é¢˜ä¸­çš„åº”ç”¨...'çš„æ–‡æ¡£",
    "nodes": [
      {
        "id": "node_1",
        "title": "æ¦‚è¿°ä¸èƒŒæ™¯",
        "content_summary": "ä»‹ç»åˆ†æâ€œåˆ†æ²»ç­–ç•¥â€åœ¨è§£å†³å¤§å‹è¯­è¨€æ¨¡å‹ä¸Šä¸‹æ–‡çš„åŸºæœ¬æ¦‚å¿µå’Œé‡è¦æ€§",
        "children": []
      },
      {
        "id": "node_2",
        "title": "æ ¸å¿ƒå†…å®¹åˆ†æ",
        "content_summary": "æ·±å…¥åˆ†æåˆ†æâ€œåˆ†æ²»ç­–ç•¥â€åœ¨è§£å†³å¤§å‹è¯­è¨€æ¨¡å‹ä¸Šä¸‹æ–‡çš„å…³é”®è¦ç´ ",
        "children": []
      },
      {
        "id": "node_3",
        "title": "åº”ç”¨ä¸å®è·µ",
        "content_summary": "æ¢è®¨åˆ†æâ€œåˆ†æ²»ç­–ç•¥â€åœ¨è§£å†³å¤§å‹è¯­è¨€æ¨¡å‹ä¸Šä¸‹æ–‡çš„å®é™…åº”ç”¨åœºæ™¯",
        "children": []
      }
    ]
  }
}
# ^^^^^^^^^^^^ åœ¨è¿™é‡Œç²˜è´´ä½ ä¸Šä¸€æ­¥è·å–åˆ°çš„å¤§çº²å†…å®¹ ^^^^^^^^^^^^

###
# !!! æœ€ç»ˆç”Ÿæˆä»»åŠ¡å·²è§¦å‘ï¼Œç°åœ¨å¯ä»¥ç›‘å¬ä¸‹é¢çš„æµäº† !!!
# =================================================================
# é˜¶æ®µäºŒï¼šè§‚å¯Ÿå®æ—¶æµ
# =================================================================

### 5. ã€æ ¸å¿ƒã€‘ç›‘å¬å®æ—¶äº‹ä»¶æµ
# REST Client ä¼šè‡ªåŠ¨å¤„ç† SSEï¼Œåœ¨å³ä¾§çª—å£æŒç»­æ˜¾ç¤ºæ–°äº‹ä»¶
GET {{baseUrl}}/jobs/{{job_id}}/events
X-API-KEY: {{apiKey}}

###

### 6. ã€æ ¸å¿ƒã€‘ç›‘å¬æ–‡æ¡£å†…å®¹æµ
# ä½ å¯ä»¥æ‰“å¼€ç¬¬äºŒä¸ªç¼–è¾‘å™¨çª—å£ï¼Œå¹¶æ’æŸ¥çœ‹ä¸¤ä¸ªæµ
GET {{baseUrl}}/jobs/{{job_id}}/document/stream
X-API-KEY: {{apiKey}}

###
# =================================================================
# é˜¶æ®µä¸‰ï¼šè·å–æœ€ç»ˆç»“æœ
# =================================================================

### 7. è·å–æœ€ç»ˆç”Ÿæˆçš„æ–‡æ¡£
# ç­‰å¾…å·¥ä½œæµå®Œæˆåï¼Œè·å–å®Œæ•´çš„æ–‡æ¡£å†…å®¹å’Œç»Ÿè®¡ä¿¡æ¯
GET {{baseUrl}}/jobs/{{job_id}}/document
X-API-KEY: {{apiKey}}